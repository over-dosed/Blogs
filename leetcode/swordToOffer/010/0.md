#剑指offer 010 和为k的子数组

![20220125170302](https://picture-1308922338.cos.ap-guangzhou.myqcloud.com/note/20220125170302.png)

## 思路

这里本来想用滑动窗口解题，毕竟是“连续的子数组”

但是发现数组中可能存在**负数**，于是放弃了滑动窗口。

### 滑动窗口的力所不及

在套模板的同时，大家是否考虑过，假设题目同样是求连续的子数组，但是在数组中出现了负数，那这种情况下还可以使用滑动窗口么？

答案是**不行**的，为什么？

我们窗口滑动的条件是什么，while窗口内元素超过或者不满足条件时移动，但如果数组存在负数，遇到不满足题意的时候，我们应该移动窗口左边界，还是扩大窗口右边界从而寻找到符合条件的情况呢？

当一种场景存在多种可能时，显然就是当前的算法不适配解题。今天就为大家介绍另一种数组中常用的算法----**前缀和**。

### 前缀和的解题思想

前缀和的题目解题思维比较固定，即当我们循环数组到下标N时，需要用到数组前N-1项的计算的结果（这里不一定非要是和，也可能是积等），此时我们就该考虑是否应该通过计算数组循环过程中的累计值的方式简化解题，如此便有了前缀和的解题思想。

了解了思想，下来就该考虑，这个累计的结果我们该通过什么方式保存起来呢？

1. 题目明确要求不允许使用额外空间的，直接原地修改数组

2. 不限制空间复杂度时，最好额外开辟空间计算，避免数据污染

3. 计算时如果每次只需要获取前一次的累计结果，可以通过数组的方式存储每次获取数组末尾元素的值

4. 如果每次计算需要获取前几次或更多次的结果进行对比时，推荐哈希表的方式，这样可以压缩时间复杂度

**这道题采用哈希存储和的前缀和进行计算**

## 前缀和

![20220125171027](https://picture-1308922338.cos.ap-guangzhou.myqcloud.com/note/20220125171027.png)

**也就是，当查找到sum-k时，说明sum-k代表的前缀和所在的位置到当前位置的区间，和为k**

即： 10(4所在的sum) - 7(k) = 3(2所在的sum)

故 3、4 之和为7

而该题中的hash ， 存储的是该前缀和出现的次数

若前缀和出现次数为1，说明在此位置之前，有1个位置的前缀和值都为某值

若前缀和出现次数为3，说明在此位置之前，有3个位置的前缀和值都为某值

**例**： 当循环到下标为6时，发现 2，3，5处的前缀和都为3，

那么当sum-k = 3 , 应有三种方法可以使得子数组和为k，分别为{2，3，4，5}、{3，4，5}、{5}

### 解题

1. 先加入哈希{0，1}，说明前缀和为0的出现次数为 1；否则在开头第一个元素时会出现错误

2. 依次遍历数组，计算该位置的前缀和（前一位置的前缀和加当前位置的值）

3. 判断sum - k 是否在哈希表中出现，若出现，则result += 出现次数；

4. 判断当前位置前缀和sum是否在哈希中出现，若出现则value += 1； 若没出现则设置，且 value = 1；

## 代码

~~~c++
class Solution {
public:
    int subarraySum(vector<int>& nums, int k) 
    {
        int sum = 0;
        int result = 0;

        unordered_map<int,int> hash;

        hash.insert({0,1});
        for(int i = 0;i<nums.size();i++)
        {
            sum = i == 0 ? nums[0] : nums[i-1] + nums[i];
            nums[i] = sum;
            if(hash.find(sum -k) != hash.end()) // 找到子数组
            {
                result += hash[sum - k];
            }
            if(hash.find(sum) != hash.end()) // 找到sum前缀和
            {
                hash[sum] ++;
            }
            else
            {
                hash.insert({sum,1});
            }
        }
        return result;
    }
};
~~~

![20220125181731](https://picture-1308922338.cos.ap-guangzhou.myqcloud.com/note/20220125181731.png)